<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard â€” Alisha Mart (Export/Import)</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body { display:flex; min-height:100vh; margin:0; font-family:Arial, sans-serif; background:#f8f9fa; }
    .sidebar { width:240px; background:#1a2a44; color:#fff; display:flex; flex-direction:column; padding:20px 0; }
    .sidebar h2 { text-align:center; margin-bottom:20px; font-size:18px; }
    .sidebar a { color:#fff; padding:12px 20px; text-decoration:none; display:block; }
    .sidebar a:hover, .sidebar a.active { background:#ff6600; }
    .main { flex:1; padding:20px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    .logout-btn { background:#e74c3c; color:#fff; padding:8px 16px; border-radius:6px; text-decoration:none; }
    .stats { display:grid; grid-template-columns:repeat(4,1fr); gap:20px; margin-bottom:20px; }
    .stat-box { background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-align:center; }
    table { width:100%; border-collapse:collapse; margin-top:15px; background:#fff; border-radius:8px; overflow:hidden; }
    th, td { padding:12px; border-bottom:1px solid #eee; text-align:center; }
    th { background:#f4f4f4; }
    .btn { background:#ff6600; color:#fff; padding:8px 12px; border-radius:6px; text-decoration:none; cursor:pointer; border:none; }
    .btn.secondary { background:#6b7280; }
    .tab-section { display:none; }
    .tab-section.active { display:block; }
    .controls { display:flex; gap:10px; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
    input[type="text"], input[type="number"], textarea { padding:8px; border:1px solid #ddd; border-radius:6px; }
    .modal { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.4); }
    .modal.active { display:flex; }
    .modal-card { background:#fff; padding:18px; border-radius:8px; width:520px; max-width:95%; }
    .form-row { display:flex; gap:8px; }
    .small { width:120px; }
    .muted { color:#6b7280; }
    .file-input { display:none; }
    .danger { background:#e74c3c; }
    @media (max-width:900px){ .stats { grid-template-columns:repeat(2,1fr); } .sidebar{display:none} body{display:block} }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Admin Panel</h2>
    <a href="#" class="tab-link active" data-tab="overview">Overview</a>
    <a href="#" class="tab-link" data-tab="products">Products</a>
    <a href="#" class="tab-link" data-tab="orders">Orders</a>
    <a href="#" class="tab-link" data-tab="users">Users</a>
    <a href="#" class="tab-link" data-tab="settings">Settings</a>
  </div>

  <div class="main">
    <div class="topbar">
      <h1>Admin Dashboard</h1>
      <a href="account.html" class="logout-btn">Logout</a>
    </div>

    <div id="overview" class="tab-section active">
      <div class="stats">
        <div class="stat-box"><h3 id="stat-sales">$0</h3><p>Total Sales</p></div>
        <div class="stat-box"><h3 id="stat-orders">0</h3><p>Orders</p></div>
        <div class="stat-box"><h3 id="stat-customers">0</h3><p>Customers</p></div>
        <div class="stat-box"><h3 id="stat-products">0</h3><p>Products</p></div>
      </div>
      <p class="muted">Use the sidebar to manage products, orders, users, and store settings. Changes are saved locally in your browser (localStorage).</p>
    </div>

    <div id="products" class="tab-section">
      <div class="controls">
        <button class="btn" id="add-product-btn">Add New Product</button>
        <input id="search-product" type="text" placeholder="Search products..." />
        <button class="btn secondary" id="export-products-csv">Export CSV</button>
        <button class="btn secondary" id="export-products-json">Export JSON</button>
        <label class="btn secondary" for="import-products-file">Import (CSV/JSON)</label>
        <input id="import-products-file" class="file-input" type="file" accept=".csv,.json">
      </div>
      <table id="products-table">
        <thead>
          <tr><th>ID</th><th>Name</th><th>Price</th><th>Stock</th><th>Action</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="orders" class="tab-section">
      <div class="controls">
        <button class="btn" id="create-order-btn">Create Dummy Order</button>
        <button class="btn secondary" id="export-orders-csv">Export CSV</button>
        <button class="btn secondary" id="export-orders-json">Export JSON</button>
        <label class="btn secondary" for="import-orders-file">Import (CSV/JSON)</label>
        <input id="import-orders-file" class="file-input" type="file" accept=".csv,.json">
      </div>
      <table id="orders-table">
        <thead><tr><th>Order ID</th><th>Customer</th><th>Total</th><th>Status</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="users" class="tab-section">
      <div class="controls">
        <button class="btn" id="add-user-btn">Add New User</button>
        <input id="search-user" type="text" placeholder="Search users..." />
        <button class="btn secondary" id="export-users-csv">Export CSV</button>
        <button class="btn secondary" id="export-users-json">Export JSON</button>
        <label class="btn secondary" for="import-users-file">Import (CSV/JSON)</label>
        <input id="import-users-file" class="file-input" type="file" accept=".csv,.json">
      </div>
      <table id="users-table">
        <thead><tr><th>User ID</th><th>Name</th><th>Email</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="settings" class="tab-section">
      <h2>Store Settings</h2>
      <div style="display:grid; gap:10px; max-width:640px;">
        <label>Store Name<input id="store-name" type="text"></label>
        <label>Contact Email<input id="store-email" type="text"></label>
        <label>Return Policy<textarea id="store-policy" rows="4"></textarea></label>
        <div style="display:flex; gap:8px; align-items:center;">
          <button class="btn" id="save-settings">Save Settings</button>
          <button class="btn danger" id="clear-all-data">Clear All Data</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <h3 id="modal-title">Add Product</h3>
      <div id="modal-body">
        <div class="form-row">
          <input id="prod-name" type="text" placeholder="Product name" style="flex:1">
          <input id="prod-price" type="number" placeholder="Price" class="small">
        </div>
        <div style="margin-top:8px" class="form-row">
          <input id="prod-stock" type="number" placeholder="Stock" class="small">
          <input id="prod-image" type="text" placeholder="Image URL (optional)" style="flex:1">
        </div>
        <div style="margin-top:8px">
          <textarea id="prod-desc" rows="3" placeholder="Short description" style="width:100%"></textarea>
        </div>
        <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end;">
          <button class="btn secondary" id="modal-cancel">Cancel</button>
          <button class="btn" id="modal-save">Save</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Storage keys and defaults
    const KEY_PRODUCTS = 'am_products_v1';
    const KEY_ORDERS = 'am_orders_v1';
    const KEY_USERS = 'am_users_v1';
    const KEY_SETTINGS = 'am_settings_v1';

    const defaultProducts = [
      {id:1, name:'Wireless Earbuds', price:39.99, stock:50, desc:'Wireless earbuds with great sound.'},
      {id:2, name:'Classic Wristwatch', price:79.00, stock:30, desc:'Elegant wristwatch for everyday use.'}
    ];
    const defaultUsers = [
      {id:1, name:'John Doe', email:'john@example.com'},
      {id:2, name:'Jane Smith', email:'jane@example.com'}
    ];
    const defaultOrders = [
      {id:1001, customer:'John Doe', total:120.00, status:'Delivered'},
      {id:1002, customer:'Jane Smith', total:85.50, status:'Pending'}
    ];

    function read(key, fallback){ const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : fallback; }
    function write(key, data){ localStorage.setItem(key, JSON.stringify(data)); }

    if(!localStorage.getItem(KEY_PRODUCTS)) write(KEY_PRODUCTS, defaultProducts);
    if(!localStorage.getItem(KEY_USERS)) write(KEY_USERS, defaultUsers);
    if(!localStorage.getItem(KEY_ORDERS)) write(KEY_ORDERS, defaultOrders);
    if(!localStorage.getItem(KEY_SETTINGS)) write(KEY_SETTINGS, {storeName:'Alisha Mart', storeEmail:'support@alishamart.com', policy:'7-day returns'});

    // Elements
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabSections = document.querySelectorAll('.tab-section');
    const productsTableBody = document.querySelector('#products-table tbody');
    const ordersTableBody = document.querySelector('#orders-table tbody');
    const usersTableBody = document.querySelector('#users-table tbody');

    function setActiveTab(tab){
      tabLinks.forEach(l=>l.classList.toggle('active', l.dataset.tab===tab));
      tabSections.forEach(s=>s.classList.toggle('active', s.id===tab));
      updateOverviewStats();
    }
    tabLinks.forEach(link => link.addEventListener('click', e=>{ e.preventDefault(); setActiveTab(link.dataset.tab); }));

    // Overview stats
    function updateOverviewStats(){
      const prods = read(KEY_PRODUCTS,[]);
      const orders = read(KEY_ORDERS,[]);
      const users = read(KEY_USERS,[]);
      const sales = orders.reduce((sum,o)=>sum+ (o.total||0),0);
      document.getElementById('stat-products').textContent = prods.length;
      document.getElementById('stat-orders').textContent = orders.length;
      document.getElementById('stat-customers').textContent = users.length;
      document.getElementById('stat-sales').textContent = '$' + sales.toFixed(2);
    }

    // Render functions
    function renderProducts(filter=''){
      const prods = read(KEY_PRODUCTS,[]);
      productsTableBody.innerHTML='';
      prods.filter(p=> p.name.toLowerCase().includes(filter.toLowerCase())).forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.id}</td><td>${p.name}</td><td>$${p.price.toFixed(2)}</td><td>${p.stock}</td>
          <td><button class="btn" data-action="edit" data-id="${p.id}">Edit</button>
          <button class="btn secondary" data-action="delete" data-id="${p.id}">Delete</button></td>`;
        productsTableBody.appendChild(tr);
      });
    }
    function renderOrders(){
      const orders = read(KEY_ORDERS,[]);
      ordersTableBody.innerHTML='';
      orders.forEach(o=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${o.id}</td><td>${o.customer}</td><td>$${(o.total||0).toFixed(2)}</td>
          <td><select data-id="${o.id}" class="order-status"><option ${o.status==='Pending'?'selected':''}>Pending</option><option ${o.status==='Shipped'?'selected':''}>Shipped</option><option ${o.status==='Delivered'?'selected':''}>Delivered</option></select></td>
          <td><button class="btn" data-action="view-order" data-id="${o.id}">View</button></td>`;
        ordersTableBody.appendChild(tr);
      });
    }
    function renderUsers(filter=''){
      const users = read(KEY_USERS,[]);
      usersTableBody.innerHTML='';
      users.filter(u=> u.name.toLowerCase().includes(filter.toLowerCase()) || u.email.toLowerCase().includes(filter.toLowerCase())).forEach(u=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${u.id}</td><td>${u.name}</td><td>${u.email}</td><td><button class="btn" data-action="edit-user" data-id="${u.id}">Edit</button> <button class="btn secondary" data-action="delete-user" data-id="${u.id}">Delete</button></td>`;
        usersTableBody.appendChild(tr);
      });
    }

    // Initial render
    renderProducts();
    renderOrders();
    renderUsers();
    updateOverviewStats();

    // Search handlers
    document.getElementById('search-product').addEventListener('input', e=> renderProducts(e.target.value));
    document.getElementById('search-user').addEventListener('input', e=> renderUsers(e.target.value));

    // Modal controls for Add/Edit product
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalSave = document.getElementById('modal-save');
    let editingProductId = null;

    document.getElementById('add-product-btn').addEventListener('click', ()=>{
      editingProductId = null;
      modalTitle.textContent = 'Add Product';
      document.getElementById('prod-name').value='';
      document.getElementById('prod-price').value='';
      document.getElementById('prod-stock').value='';
      document.getElementById('prod-desc').value='';
      document.getElementById('prod-image').value='';
      modal.classList.add('active');
    });

    document.getElementById('modal-cancel').addEventListener('click', ()=> modal.classList.remove('active'));

    modalSave.addEventListener('click', ()=>{
      const name = document.getElementById('prod-name').value.trim();
      const price = parseFloat(document.getElementById('prod-price').value) || 0;
      const stock = parseInt(document.getElementById('prod-stock').value) || 0;
      const desc = document.getElementById('prod-desc').value.trim();
      if(!name){ alert('Provide a product name'); return; }
      let prods = read(KEY_PRODUCTS,[]);
      if(editingProductId){
        prods = prods.map(p=> p.id===editingProductId ? {...p, name, price, stock, desc} : p);
      } else {
        const nextId = prods.length ? Math.max(...prods.map(p=>p.id))+1 : 1;
        prods.push({id:nextId, name, price, stock, desc});
      }
      write(KEY_PRODUCTS, prods);
      renderProducts();
      updateOverviewStats();
      modal.classList.remove('active');
    });

    // Product table actions (edit/delete)
    productsTableBody.addEventListener('click', e=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const action = btn.dataset.action;
      const id = parseInt(btn.dataset.id);
      let prods = read(KEY_PRODUCTS,[]);
      if(action==='edit'){
        const p = prods.find(x=>x.id===id);
        if(!p) return;
        editingProductId = id;
        modalTitle.textContent = 'Edit Product';
        document.getElementById('prod-name').value = p.name;
        document.getElementById('prod-price').value = p.price;
        document.getElementById('prod-stock').value = p.stock;
        document.getElementById('prod-desc').value = p.desc || '';
        modal.classList.add('active');
      }
      if(action==='delete'){
        if(!confirm('Delete this product?')) return;
        prods = prods.filter(x=>x.id!==id);
        write(KEY_PRODUCTS, prods);
        renderProducts();
        updateOverviewStats();
      }
    });

    // Orders: Create dummy order
    document.getElementById('create-order-btn').addEventListener('click', ()=>{
      const orders = read(KEY_ORDERS,[]);
      const users = read(KEY_USERS,[]);
      const prods = read(KEY_PRODUCTS,[]);
      const next = orders.length ? Math.max(...orders.map(o=>o.id))+1 : 1001;
      const customer = users.length ? users[0].name : 'Guest';
      const total = prods.length ? prods.slice(0,2).reduce((s,p)=>s+p.price,0) : 0;
      orders.push({id: next, customer, total, status:'Pending'});
      write(KEY_ORDERS, orders);
      renderOrders();
      updateOverviewStats();
    });

    // Orders: change status
    ordersTableBody.addEventListener('change', e=>{
      if(e.target.classList.contains('order-status')){
        const id = parseInt(e.target.dataset.id);
        const val = e.target.value;
        const orders = read(KEY_ORDERS,[]).map(o=> o.id===id ? {...o, status: val} : o);
        write(KEY_ORDERS, orders);
        renderOrders();
        updateOverviewStats();
      }
    });

    // Users: add/edit/delete
    const addUserBtn = document.getElementById('add-user-btn');
    addUserBtn.addEventListener('click', ()=>{
      const name = prompt('Enter user full name');
      const email = prompt('Enter user email');
      if(!name || !email) return alert('Name and email are required');
      const users = read(KEY_USERS,[]);
      const nextId = users.length ? Math.max(...users.map(u=>u.id))+1 : 1;
      users.push({id: nextId, name, email});
      write(KEY_USERS, users);
      renderUsers();
      updateOverviewStats();
    });

    usersTableBody.addEventListener('click', e=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const action = btn.dataset.action;
      const id = parseInt(btn.dataset.id);
      let users = read(KEY_USERS,[]);
      if(action==='edit-user'){
        const u = users.find(x=>x.id===id);
        const name = prompt('Edit name', u.name);
        const email = prompt('Edit email', u.email);
        if(!name || !email) return alert('Invalid input');
        users = users.map(x=> x.id===id ? {...x, name, email} : x);
        write(KEY_USERS, users);
        renderUsers();
      }
      if(action==='delete-user'){
        if(!confirm('Remove this user?')) return;
        users = users.filter(x=> x.id!==id);
        write(KEY_USERS, users);
        renderUsers();
        updateOverviewStats();
      }
    });

    // Settings save/load & clear all data
    const storeName = document.getElementById('store-name');
    const storeEmail = document.getElementById('store-email');
    const storePolicy = document.getElementById('store-policy');
    function loadSettings(){ const s = read(KEY_SETTINGS,{}); storeName.value = s.storeName||''; storeEmail.value = s.storeEmail||''; storePolicy.value = s.policy||''; }
    document.getElementById('save-settings').addEventListener('click', ()=>{
      const s = {storeName: storeName.value, storeEmail: storeEmail.value, policy: storePolicy.value};
      write(KEY_SETTINGS, s);
      alert('Settings saved locally.');
    });
    document.getElementById('clear-all-data').addEventListener('click', ()=>{
      if(!confirm('This will DELETE all local data for this demo (products, orders, users, settings). Continue?')) return;
      localStorage.removeItem(KEY_PRODUCTS);
      localStorage.removeItem(KEY_ORDERS);
      localStorage.removeItem(KEY_USERS);
      localStorage.removeItem(KEY_SETTINGS);
      location.reload();
    });
    loadSettings();

    // ---------------- Export / Import utilities ----------------
    function todayDate(){ const d = new Date(); const y=d.getFullYear(); const m=String(d.getMonth()+1).padStart(2,'0'); const day=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${day}`; }

    function downloadFile(filename, content, mime='text/plain'){ const blob = new Blob([content], {type: mime}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }

    function arrayToCSV(arr){ if(!arr.length) return ''; const keys = Object.keys(arr[0]); const lines = [keys.join(',')]; arr.forEach(obj=>{ const row = keys.map(k=> { const v = obj[k]===undefined||obj[k]===null?'':String(obj[k]).replace(/"/g,'""'); return `"${v}"`; }).join(','); lines.push(row); }); return lines.join('\n'); }

    function parseCSV(text){ const lines = text.split(/\r?\n/).filter(l=>l.trim()!==''); if(!lines.length) return []; const header = lines[0].split(',').map(h=>h.replace(/^"|"$/g,'').trim()); const data = []; for(let i=1;i<lines.length;i++){ const cols = lines[i].match(/(".*?"|[^",\s]+)(?=,|$)/g) || []; const obj = {}; for(let j=0;j<header.length;j++){ let val = cols[j] || ''; val = val.replace(/^"|"$/g,''); if(/^[0-9]+(\.[0-9]+)?$/.test(val)) val = Number(val); obj[header[j]] = val; } data.push(obj); } return data; }

    function mergeById(key, existingArray, incomingArray){ const map = new Map(existingArray.map(i=>[Number(i.id), i])); incomingArray.forEach(item=>{ const id = Number(item.id); if(Number.isNaN(id) || id<=0){ // assign new id
        const nextId = map.size ? Math.max(...Array.from(map.keys()))+1 : 1; item.id = nextId; map.set(nextId, item); } else if(map.has(id)){ const merged = {...map.get(id), ...item}; map.set(id, merged); } else { map.set(id, item); } }); return Array.from(map.values()); }

    // Export handlers
    function exportData(type){ if(type==='products'){ const data=read(KEY_PRODUCTS,[]); const date=todayDate(); downloadFile(`products_${date}.json`, JSON.stringify(data, null, 2),'application/json'); downloadFile(`products_${date}.csv`, arrayToCSV(data),'text/csv'); }
      if(type==='orders'){ const data=read(KEY_ORDERS,[]); const date=todayDate(); downloadFile(`orders_${date}.json`, JSON.stringify(data, null, 2),'application/json'); downloadFile(`orders_${date}.csv`, arrayToCSV(data),'text/csv'); }
      if(type==='users'){ const data=read(KEY_USERS,[]); const date=todayDate(); downloadFile(`users_${date}.json`, JSON.stringify(data, null, 2),'application/json'); downloadFile(`users_${date}.csv`, arrayToCSV(data),'text/csv'); } }

    document.getElementById('export-products-csv').addEventListener('click', ()=> exportData('products'));
    document.getElementById('export-products-json').addEventListener('click', ()=> exportData('products'));
    document.getElementById('export-orders-csv').addEventListener('click', ()=> exportData('orders'));
    document.getElementById('export-orders-json').addEventListener('click', ()=> exportData('orders'));
    document.getElementById('export-users-csv').addEventListener('click', ()=> exportData('users'));
    document.getElementById('export-users-json').addEventListener('click', ()=> exportData('users'));

    // Import handlers
    function handleImportFile(file, type){ const reader = new FileReader(); reader.onload = (e)=>{ try{ const text = e.target.result.trim(); let parsed = []; if(file.name.toLowerCase().endsWith('.json')){ parsed = JSON.parse(text); } else { parsed = parseCSV(text); } // merge
        if(type==='products'){ const existing = read(KEY_PRODUCTS,[]); const merged = mergeById(KEY_PRODUCTS, existing, parsed); write(KEY_PRODUCTS, merged); renderProducts(); updateOverviewStats(); alert('Products imported and merged successfully.'); }
        if(type==='orders'){ const existing = read(KEY_ORDERS,[]); const merged = mergeById(KEY_ORDERS, existing, parsed); write(KEY_ORDERS, merged); renderOrders(); updateOverviewStats(); alert('Orders imported and merged successfully.'); }
        if(type==='users'){ const existing = read(KEY_USERS,[]); const merged = mergeById(KEY_USERS, existing, parsed); write(KEY_USERS, merged); renderUsers(); updateOverviewStats(); alert('Users imported and merged successfully.'); }
      } catch(err){ console.error(err); alert('Failed to import file. Ensure it is valid CSV or JSON.'); } };
      reader.readAsText(file);
    }

    document.getElementById('import-products-file').addEventListener('change', e=>{ const f = e.target.files[0]; if(f) handleImportFile(f,'products'); e.target.value=''; });
    document.getElementById('import-orders-file').addEventListener('change', e=>{ const f = e.target.files[0]; if(f) handleImportFile(f,'orders'); e.target.value=''; });
    document.getElementById('import-users-file').addEventListener('change', e=>{ const f = e.target.files[0]; if(f) handleImportFile(f,'users'); e.target.value=''; });

    // Final init
    updateOverviewStats(); renderProducts(); renderOrders(); renderUsers();

    // Modal close on outside click
    modal.addEventListener('click', e=>{ if(e.target===modal) modal.classList.remove('active'); });
    document.addEventListener('keydown', e=>{ if(e.key==='Escape') modal.classList.remove('active'); });
  </script>
</body>
</html>
